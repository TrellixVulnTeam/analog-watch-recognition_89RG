schema: '2.0'
stages:
  download-images:
    cmd: python scripts/download-images.py datasets/watch-faces.json
    deps:
    - path: datasets/watch-faces.json
      md5: 3a4bceadbf8919f79d8d54cf9e4cf798
      size: 644258
    - path: scripts/download-images.py
      md5: 163a2ddbebf57d03fc4ac6640fff005b
      size: 1804
    outs:
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 17f79e1cbb37ff869a2b6109fd5ecff8.dir
      size: 79597491
      nfiles: 141
    - path: datasets/val
      md5: 99f455ab8c8d2db34f9b5c994e17cb00.dir
      size: 6906661
      nfiles: 9
    - path: datasets/watch-faces-local.json
      md5: a2ef536988b8940b0e408be98229d777
      size: 639750
  train-detector:
    cmd: python watch_recognition/watch_recognition/train/object_detection_task.py  --epochs
      50  --batch-size 16  --confidence-threshold 0.5  --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/detector/
      md5: 4f0ef251a21db42f82d745ffc44d4b34.dir
      size: 436687933
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 29abfb890b9f24cfd5c88b984c94b542.dir
      size: 77425813
      nfiles: 127
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/object_detection_task.py
      md5: 0059714c8043a663887626a9145399c3
      size: 31995
    params:
      params.yaml:
        detector:
          epochs: 50
          batch-size: 16
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/detector/test-image.jpg
      md5: a5cc19044469eccf208dfce651c794e3
      size: 128283
    - path: metrics/detector.json
      md5: ff485280d6b054ce2032e7fa6414c13b
      size: 134
    - path: metrics/detector/scalars
      md5: 18efba71039e57fa6690b111feb43bee.dir
      size: 3824
      nfiles: 2
    - path: models/detector/
      md5: 2fe2eb75b5ccb979c49b1d8ec9956239.dir
      size: 153500837
      nfiles: 5
  eval-detector:
    cmd: python watch_recognition/watch_recognition/eval/object_detection_eval.py
    deps:
    - path: models/detector/
      md5: 2fe2eb75b5ccb979c49b1d8ec9956239.dir
      size: 153500837
      nfiles: 5
    - path: watch_recognition/watch_recognition/eval/object_detection_eval.py
      md5: 478531f43a49a31856d86e9e6233247e
      size: 5845
    outs:
    - path: example_predictions/detector/train_0.jpg
      md5: b340ee5e3c4f9fb98dedd93cf1762aa9
      size: 205095
    - path: example_predictions/detector/train_1.jpg
      md5: 2fa8e5e13558229db36e97dfdb8ee9cf
      size: 112273
    - path: example_predictions/detector/train_2.jpg
      md5: 00a5950c2a198d370677c1bf187a95fd
      size: 89322
    - path: example_predictions/detector/train_3.jpg
      md5: c6f3b98cd170f81f8c3a421ad7eb4019
      size: 135908
    - path: example_predictions/detector/train_4.jpg
      md5: b7ed6d39931ac36011ab5eeb97062f2d
      size: 84641
    - path: example_predictions/detector/val_0.jpg
      md5: 625b08142322445571c3300f923f2774
      size: 83615
    - path: example_predictions/detector/val_1.jpg
      md5: 4de7e7afbfb12498eb822c514e6045cd
      size: 133065
    - path: example_predictions/detector/val_2.jpg
      md5: 643fc8cf2c49c14cdc0a4fcc70083539
      size: 203005
    - path: example_predictions/detector/val_3.jpg
      md5: feb5861a1643f5af664a22dad0faf8a3
      size: 112519
    - path: metrics/detector/PR-IoU@0.50_train.tsv
      md5: 21db64532e9b32b8edb2c4d1fd5086ee
      size: 1690
    - path: metrics/detector/PR-IoU@0.50_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.75_train.tsv
      md5: b2f53b30514816f5cd3f947299fdc794
      size: 1615
    - path: metrics/detector/PR-IoU@0.75_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.95_train.tsv
      md5: efd98654a2a3e961286a3216e589d0db
      size: 1154
    - path: metrics/detector/PR-IoU@0.95_val.tsv
      md5: eb9c22f401e52e662cc9020d738478e0
      size: 1059
    - path: metrics/detector/coco_train.json
      md5: ad2f7466aca6670aa7bc2e6c671c64db
      size: 265
    - path: metrics/detector/coco_val.json
      md5: 23bba99a6c9b2700a811c39fd9d312f8
      size: 254
  update-metrics:
    cmd: python scripts/update-metrics-table-and-graph.py
    deps:
    - path: metrics
      md5: 37c818c5975a11c3a509f8d8a96a51dd.dir
      size: 175299
      nfiles: 35
  train-keypoint:
    cmd: python watch_recognition/watch_recognition/train/heatmap_regression_task.py
      --epochs 25 --batch-size 16 --confidence-threshold 0.5 --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/keypoint/
      md5: 93aaf13ff65a6ac56d4a9b0562091545.dir
      size: 84348803
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 29abfb890b9f24cfd5c88b984c94b542.dir
      size: 77425813
      nfiles: 127
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/heatmap_regression_task.py
      md5: 30ee8c44e78b4e3fc23ffa2ef04eb501
      size: 7034
    params:
      params.yaml:
        keypoint:
          epochs: 25
          batch-size: 16
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/keypoint/test-image-2.jpg
      md5: f090a4b1eaa026b1033bfa789bf4bb20
      size: 66281
    - path: metrics/keypoint.json
      md5: 0b35fe05cc438aa93971abed31310c1a
      size: 214
    - path: metrics/keypoint/scalars/
      md5: 5aa7ee0666a6941a2a4bdf2a55c94a9c.dir
      size: 3789
      nfiles: 4
    - path: models/keypoint/
      md5: c94b27064baff3c096dc0e511b584c88.dir
      size: 35964016
      nfiles: 6
  eval-keypoint:
    cmd: python watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      --kp-confidence-threshold 0.5
    deps:
    - path: models/detector/
      md5: 2fe2eb75b5ccb979c49b1d8ec9956239.dir
      size: 153500837
      nfiles: 5
    - path: models/keypoint/
      md5: c94b27064baff3c096dc0e511b584c88.dir
      size: 35964016
      nfiles: 6
    - path: watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      md5: 8e4719ba04b6104e3ed2338136d40fc6
      size: 6078
    outs:
    - path: example_predictions/keypoint/train_0.jpg
      md5: d42b42f7ff08dde62e432ca93a937ea6
      size: 73594
    - path: example_predictions/keypoint/train_1.jpg
      md5: 14ca1d24b41933fca528abe8556fb117
      size: 51105
    - path: example_predictions/keypoint/train_2.jpg
      md5: 9bd7d9369e1842fb8098453b94fadd91
      size: 59925
    - path: example_predictions/keypoint/train_3.jpg
      md5: 42a5d94ffb6d34215a23b604c34fb447
      size: 27522
    - path: example_predictions/keypoint/train_4.jpg
      md5: 623b5ae543195a5f0dfc0785d8bfe87e
      size: 38961
    - path: example_predictions/keypoint/val_0.jpg
      md5: 1b942e2782179ec4c823f02deb179839
      size: 57151
    - path: example_predictions/keypoint/val_1.jpg
      md5: 7467cfb590abed02d879a891745dff6d
      size: 60665
    - path: example_predictions/keypoint/val_2.jpg
      md5: 0e6eecaba8f424be5fe815738cd10623
      size: 70445
    - path: example_predictions/keypoint/val_3.jpg
      md5: 89e453a5637031698e77f17c0924baab
      size: 59024
    - path: example_predictions/keypoint/val_4.jpg
      md5: 5618e1ec52d119a6661e913ff9ffddae
      size: 73953
    - path: metrics/keypoint/coco_train.json
      md5: eacebb09cca2e828217494797e8625ce
      size: 249
    - path: metrics/keypoint/coco_val.json
      md5: 4ebec0be63e9b76b783b815f4ff3bf1d
      size: 260
  train-segmentation:
    cmd: python watch_recognition/watch_recognition/train/segmentation_task.py --epochs
      25 --batch-size 16 --confidence-threshold 0.5 --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/segmentation/
      md5: f69ac8b89feb20dbd86a7e770e9fe38e.dir
      size: 84321131
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 29abfb890b9f24cfd5c88b984c94b542.dir
      size: 77425813
      nfiles: 127
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/segmentation_task.py
      md5: ac0ce2b1352a28a614afeaf5e06e52c0
      size: 7377
    params:
      params.yaml:
        seed: 42
        segmentation:
          epochs: 25
          batch-size: 16
          confidence-threshold: 0.5
    outs:
    - path: example_predictions/segmentation/test-image-2.jpg
      md5: 94c13acf02fba3c1c42e4ef75369154c
      size: 58778
    - path: metrics/segmentation.json
      md5: 6a387b67ad6597325ebab7d6ebd95c6a
      size: 215
    - path: metrics/segmentation/scalars/
      md5: 9c2252cdeb7aacf393f6578ddd072cdb.dir
      size: 3818
      nfiles: 4
    - path: models/segmentation/
      md5: d6c5d2045fa7585331ea913743e00bf7.dir
      size: 35948644
      nfiles: 5
