schema: '2.0'
stages:
  download-images:
    cmd: python scripts/download-images.py datasets/watch-faces.json
    deps:
    - path: datasets/watch-faces.json
      md5: e26b0aba7c4598bcd4f515cdca7d277c
      size: 517102
    - path: scripts/download-images.py
      md5: 163a2ddbebf57d03fc4ac6640fff005b
      size: 1804
    outs:
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 6035ad54bdfa9769e3f74127e75d20bc.dir
      size: 72489137
      nfiles: 102
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: a10817f0241af091cc81648de4cebe36
      size: 513560
  train-detector:
    cmd: python watch_recognition/watch_recognition/train/object_detection_task.py  --epochs
      20  --batch-size 4  --confidence-threshold 0.5  --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/detector/
      md5: 4f0ef251a21db42f82d745ffc44d4b34.dir
      size: 436687933
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 6035ad54bdfa9769e3f74127e75d20bc.dir
      size: 72489137
      nfiles: 102
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: a10817f0241af091cc81648de4cebe36
      size: 513560
    - path: watch_recognition/watch_recognition/train/object_detection_task.py
      md5: 3e2351cc3a473c78ca4bfb7b70814783
      size: 31853
    params:
      params.yaml:
        detector.batch-size: 4
        detector.epochs: 20
        seed: 42
    outs:
    - path: example_predictions/detector/test-image.jpg
      md5: 3e6d283e11c89444b8394a5e9de9f9e9
      size: 128323
    - path: metrics/detector.json
      md5: 91c4c86269a8eeb488c42703fbc9a94d
      size: 132
    - path: metrics/detector/scalars
      md5: a4f56b7ba1eaecc296f49c4bdb9fdb38.dir
      size: 1527
      nfiles: 2
    - path: models/detector/
      md5: 4d7092aecb32827bccab9ca40e067ccc.dir
      size: 153534387
      nfiles: 5
  eval-detector:
    cmd: python watch_recognition/watch_recognition/eval/object_detection_eval.py
    deps:
    - path: models/detector/
      md5: 4d7092aecb32827bccab9ca40e067ccc.dir
      size: 153534387
      nfiles: 5
    - path: watch_recognition/watch_recognition/eval/object_detection_eval.py
      md5: 7d611728dc4b216e57e1ca5eafa3b652
      size: 5854
    outs:
    - path: example_predictions/detector/train_0.jpg
      md5: efeb7c684da96a6746de8e9530f8c392
      size: 108021
    - path: example_predictions/detector/train_1.jpg
      md5: 05b8093d04b6b54d50457a159e199725
      size: 79245
    - path: example_predictions/detector/train_2.jpg
      md5: 57fac845d3124e44122cd5ec52715f61
      size: 161903
    - path: example_predictions/detector/train_3.jpg
      md5: b78e1b3c2434b23978985744d513a175
      size: 118126
    - path: example_predictions/detector/train_4.jpg
      md5: dd26777005731b67cbdc43bb2341780a
      size: 59913
    - path: example_predictions/detector/val_0.jpg
      md5: f2c8a8793943f4f2058223e9f1675e26
      size: 83852
    - path: example_predictions/detector/val_1.jpg
      md5: 1494820c36043f74adc34fe1e8b69254
      size: 133282
    - path: example_predictions/detector/val_2.jpg
      md5: 6b68336432eff361adaee637e559c2e8
      size: 202142
    - path: example_predictions/detector/val_3.jpg
      md5: 0484fbf915cdd9ed1431fbc7c1340e67
      size: 112606
    - path: metrics/detector/PR-IoU@0.50_train.tsv
      md5: 71a4c35f08506d002750a65db90f7698
      size: 2256
    - path: metrics/detector/PR-IoU@0.50_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.75_train.tsv
      md5: 58b1218c5ff2a04b4b89285a03f3e997
      size: 2151
    - path: metrics/detector/PR-IoU@0.75_val.tsv
      md5: 8a736d531c589c40648e33d01a87fd0a
      size: 1059
    - path: metrics/detector/PR-IoU@0.95_train.tsv
      md5: 89183ae0cd6605f0bf341663631b62ad
      size: 1096
    - path: metrics/detector/PR-IoU@0.95_val.tsv
      md5: 26c335fc24410d39b71a382aefb49571
      size: 1314
    - path: metrics/detector/coco_train.json
      md5: ba7fe29d22e6959824ab50025879a265
      size: 256
    - path: metrics/detector/coco_val.json
      md5: 2476da3287f462c67b69d52264daeaef
      size: 269
  update-metrics:
    cmd: python scripts/update-metrics-table-and-graph.py
    deps:
    - path: metrics
      md5: f19179f52fef13ed88190658253246cd.dir
      size: 94695
      nfiles: 32
  train-keypoint:
    cmd: python watch_recognition/watch_recognition/train/heatmap_regression_task.py
      --epochs 20 --batch-size 8 --confidence-threshold 0.5 --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/keypoint/
      md5: 93aaf13ff65a6ac56d4a9b0562091545.dir
      size: 84348803
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 6035ad54bdfa9769e3f74127e75d20bc.dir
      size: 72489137
      nfiles: 102
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: a10817f0241af091cc81648de4cebe36
      size: 513560
    - path: watch_recognition/watch_recognition/train/heatmap_regression_task.py
      md5: cc09943d8f9abf641c2dfc7cbc0002af
      size: 6295
    params:
      params.yaml:
        keypoint:
          epochs: 20
          batch-size: 8
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/keypoint/test-image-2.jpg
      md5: 45bfce064ecf236aedbb69fea7d4b5f0
      size: 54131
    - path: metrics/keypoint.json
      md5: 706461cb347471bb10ee9225279e6670
      size: 215
    - path: metrics/keypoint/scalars/
      md5: 8b3049a298582015c58342267ebd654c.dir
      size: 3053
      nfiles: 4
    - path: models/keypoint/
      md5: f32150b6f0dac78d4db51e3cbb68644f.dir
      size: 35771134
      nfiles: 5
  eval-keypoint:
    cmd: python watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      --kp-confidence-threshold 0.5
    deps:
    - path: models/detector/
      md5: 4d7092aecb32827bccab9ca40e067ccc.dir
      size: 153534387
      nfiles: 5
    - path: models/keypoint/
      md5: f32150b6f0dac78d4db51e3cbb68644f.dir
      size: 35771134
      nfiles: 5
    - path: watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      md5: 6f5c25080531034b9fc96ddfef7102a0
      size: 6063
    outs:
    - path: example_predictions/keypoint/train_0.jpg
      md5: 70001ca9fb54208d2fd3127003c39d54
      size: 46711
    - path: example_predictions/keypoint/train_1.jpg
      md5: a152bdd4646f40cdf18383fb38be665b
      size: 39084
    - path: example_predictions/keypoint/train_2.jpg
      md5: 4885196d85ef0aa93d9d2ada4845b1d9
      size: 49531
    - path: example_predictions/keypoint/train_3.jpg
      md5: c42750b9956fcd5382730b35bbdcbf98
      size: 50325
    - path: example_predictions/keypoint/train_4.jpg
      md5: 4dc437c9558087573ec8f2157bcf5599
      size: 50964
    - path: example_predictions/keypoint/val_0.jpg
      md5: 0f29cb88398cc391cb4b18d12dfdebb5
      size: 47255
    - path: example_predictions/keypoint/val_1.jpg
      md5: 005188f9d7d4321f2ba109b71ae9d0b7
      size: 50729
    - path: example_predictions/keypoint/val_2.jpg
      md5: a9f582be6a7a17b2fd647d2915f37226
      size: 57461
    - path: example_predictions/keypoint/val_3.jpg
      md5: 1082323ed97b9a1d767353cd43b7399a
      size: 48152
    - path: example_predictions/keypoint/val_4.jpg
      md5: 0bbf4d60f993b3075098c39b0df9fca7
      size: 60579
    - path: metrics/keypoint/coco_train.json
      md5: f9fa522e436abc4b94af09733287050c
      size: 262
    - path: metrics/keypoint/coco_val.json
      md5: 7dcb249937a1cd0eeffb9fb3825b910c
      size: 229
  train-segmentation:
    cmd: python watch_recognition/watch_recognition/train/segmentation_task.py --epochs
      1 --batch-size 8 --confidence-threshold 0.5 --seed 42
    deps:
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 6035ad54bdfa9769e3f74127e75d20bc.dir
      size: 72489137
      nfiles: 102
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: a10817f0241af091cc81648de4cebe36
      size: 513560
    - path: watch_recognition/watch_recognition/train/segmentation_task.py
      md5: 24f77fb832bf7bdfb0b5e8cce7729875
      size: 6647
    params:
      params.yaml:
        seed: 42
        segmentation:
          epochs: 1
          batch-size: 8
          confidence-threshold: 0.5
    outs:
    - path: example_predictions/segmentation/test-image-2.jpg
      md5: 31b32d6560776608525565a994c766d8
      size: 50888
    - path: metrics/segmentation.json
      md5: fa599679943322c90d9e16dbdf1a34c4
      size: 214
    - path: metrics/segmentation/scalars/
      md5: c1ac83b448bf30641531f380a1965190.dir
      size: 262
      nfiles: 4
    - path: models/segmentation/
      md5: eb4ab3f2c94b6419682d46e8effbae4f.dir
      size: 514977073
      nfiles: 20
