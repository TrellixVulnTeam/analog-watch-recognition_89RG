schema: '2.0'
stages:
  download-images:
    cmd: python scripts/download-images.py datasets/watch-faces.json --concurrent
    deps:
    - path: datasets/watch-faces.json
      md5: b91771b4afbcc268f6e3b76ff195e06b
      size: 1037986
    - path: scripts/download-images.py
      md5: a037cfab1a482a356f1d7d62804041d3
      size: 3961
    outs:
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: c517cd143a36c8444e7e19718ab7153c.dir
      size: 94131818
      nfiles: 218
    - path: datasets/val
      md5: 076600f43bf920a12327e4f2a2d54754.dir
      size: 17704892
      nfiles: 37
    - path: datasets/watch-faces-local.json
      md5: c900823f5b63cc402ad8b7aa3aad8707
      size: 1028857
  train-detector:
    cmd: python watch_recognition/watch_recognition/train/object_detection_task.py  --epochs
      60  --batch-size 16  --confidence-threshold 0.5  --seed 42
    deps:
    - path: checkpoints/detector/
      md5: 733a88cd5d39ec938c4c74742abc844d.dir
      size: 422523158
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: c517cd143a36c8444e7e19718ab7153c.dir
      size: 94131818
      nfiles: 218
    - path: datasets/val
      md5: 076600f43bf920a12327e4f2a2d54754.dir
      size: 17704892
      nfiles: 37
    - path: datasets/watch-faces-local.json
      md5: c900823f5b63cc402ad8b7aa3aad8707
      size: 1028857
    - path: watch_recognition/watch_recognition/train/object_detection_task.py
      md5: 44173eb43a48d9990d835c5ed293ce1f
      size: 11019
    params:
      params.yaml:
        detector:
          epochs: 60
          batch-size: 16
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/detector/test-image.jpg
      md5: bd1c3dff2d61b4a3de0787c7423f11c8
      size: 131269
    - path: metrics/detector.json
      md5: 52f9f8b6507b5fe8f6aa4c24bc1f8d92
      size: 480
    - path: metrics/detector/scalars
      md5: 6ff16415f93887a7495c594b802d8a79.dir
      size: 20682
      nfiles: 10
    - path: models/detector/
      md5: cfb3ce9f1a3cb628e3ae52f24bda6ee0.dir
      size: 432222822
      nfiles: 6
  eval-detector:
    cmd: python watch_recognition/watch_recognition/eval/object_detection_eval.py
    deps:
    - path: models/detector/
      md5: c8ee744e619baf859a79d31740caddad.dir
      size: 155280910
      nfiles: 6
    - path: watch_recognition/watch_recognition/eval/object_detection_eval.py
      md5: 4158239597b8bb9d7d216728e0840605
      size: 6019
    outs:
    - path: example_predictions/detector/train_0.jpg
      md5: d8d67b851d4c8d81d91d161bf11585a7
      size: 205074
    - path: example_predictions/detector/train_1.jpg
      md5: ab7d6559315fbe8c888c8d065060869c
      size: 112026
    - path: example_predictions/detector/train_2.jpg
      md5: 78a10c8bc4cb8569200e9a38bfc014db
      size: 88313
    - path: example_predictions/detector/train_3.jpg
      md5: b4d42d25b19dbfa6a43f71e30fe0f1c4
      size: 136782
    - path: example_predictions/detector/train_4.jpg
      md5: 50cc0d08a00b03976a1162600bc438c9
      size: 84313
    - path: example_predictions/detector/val_0.jpg
      md5: 0845eaa60b0c134f7036890a24c1dd38
      size: 83916
    - path: example_predictions/detector/val_1.jpg
      md5: a2a766c33a42b35ddbe11415c974624d
      size: 133439
    - path: example_predictions/detector/val_2.jpg
      md5: f0f71a7c454131219047e7b0cf43a6ff
      size: 208765
    - path: example_predictions/detector/val_3.jpg
      md5: a8871407117a3783c75fb1547f3949a6
      size: 112469
    - path: metrics/detector/PR-IoU@0.50_train.tsv
      md5: 702197ac5de726ccdc454d44f2f5d462
      size: 1645
    - path: metrics/detector/PR-IoU@0.50_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.75_train.tsv
      md5: 6373acad9da1600dd83cb416b46963ed
      size: 1529
    - path: metrics/detector/PR-IoU@0.75_val.tsv
      md5: 8a736d531c589c40648e33d01a87fd0a
      size: 1059
    - path: metrics/detector/PR-IoU@0.95_train.tsv
      md5: 38ee6e041e664a475efa27e6ecfe881b
      size: 1138
    - path: metrics/detector/PR-IoU@0.95_val.tsv
      md5: eb9c22f401e52e662cc9020d738478e0
      size: 1059
    - path: metrics/detector/coco_train.json
      md5: 12e41f1408c0a1130923c1a48f0269a2
      size: 287
    - path: metrics/detector/coco_val.json
      md5: a8fd584f0ff491ced72943d6ddc01648
      size: 227
  update-metrics:
    cmd: python scripts/update-metrics-table-and-graph.py
    deps:
    - path: metrics
      md5: 54eb7ebdea76a1446a0446df24363dae.dir
      size: 190697
      nfiles: 33
    - path: scripts/update-metrics-table-and-graph.py
      md5: 6f25059ae2169ced7fd4c1d01fd04ea0
      size: 2094
  train-keypoint:
    cmd: python watch_recognition/watch_recognition/train/heatmap_regression_task.py
      --epochs 60 --batch-size 32 --confidence-threshold 0.5 --seed 42
    deps:
    - path: checkpoints/keypoint/
      md5: 800d7d87380772dcb9fa1010b6f9de07.dir
      size: 84348803
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: c517cd143a36c8444e7e19718ab7153c.dir
      size: 94131818
      nfiles: 218
    - path: datasets/val
      md5: 076600f43bf920a12327e4f2a2d54754.dir
      size: 17704892
      nfiles: 37
    - path: datasets/watch-faces-local.json
      md5: c900823f5b63cc402ad8b7aa3aad8707
      size: 1028857
    - path: watch_recognition/watch_recognition/train/heatmap_regression_task.py
      md5: 16c5e2bb4360922c2ec1397ea8295d8b
      size: 7053
    params:
      params.yaml:
        keypoint:
          epochs: 60
          batch-size: 32
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/keypoint/test-image-2.jpg
      md5: 993f732d7408069fa9b451269f6b8ddc
      size: 66336
    - path: metrics/keypoint.json
      md5: b261fe4542b832b591e43897c63789ef
      size: 214
    - path: metrics/keypoint/scalars/
      md5: 87b8a7f5d5d7363162432de2540f6896.dir
      size: 9015
      nfiles: 4
    - path: models/keypoint/
      md5: 6381f41f1e5f70130f1dbcfdfd0e93fc.dir
      size: 36542593
      nfiles: 6
  eval-keypoint:
    cmd: python watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      --kp-confidence-threshold 0.5
    deps:
    - path: models/detector/
      md5: c8ee744e619baf859a79d31740caddad.dir
      size: 155280910
      nfiles: 6
    - path: models/keypoint/
      md5: 3d14403bb1c0811c028e3ba8da69b497.dir
      size: 36542592
      nfiles: 6
    - path: watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      md5: 3b25b23a8c308884c58b6d5ac4261f0d
      size: 6263
    outs:
    - path: example_predictions/keypoint/train_0.jpg
      md5: 1b8772499ebdd68759c7ac61e4c00e47
      size: 73556
    - path: example_predictions/keypoint/train_1.jpg
      md5: 14ca1d24b41933fca528abe8556fb117
      size: 51105
    - path: example_predictions/keypoint/train_2.jpg
      md5: 80ce0e75fe204693e32a155278651020
      size: 59948
    - path: example_predictions/keypoint/train_3.jpg
      md5: df6ccb4cc4389490f0479aaa891c5d78
      size: 27421
    - path: example_predictions/keypoint/train_4.jpg
      md5: c6759ec50d82cdb745ca2828f45f2b30
      size: 39618
    - path: example_predictions/keypoint/val_0.jpg
      md5: db027d009b2afc6c0f6e5b41f3416862
      size: 57130
    - path: example_predictions/keypoint/val_1.jpg
      md5: 52661ced7cd97008cff5f2a0e5c01fe9
      size: 61464
    - path: example_predictions/keypoint/val_2.jpg
      md5: 5e557a9e86dfc35f92274b5edae23711
      size: 70518
    - path: example_predictions/keypoint/val_3.jpg
      md5: 87832b619f8c3fb35f9b3b50d043298b
      size: 59136
    - path: example_predictions/keypoint/val_4.jpg
      md5: 64fb4522506c6f0a84ab77483c30b0da
      size: 73841
    - path: metrics/keypoint/coco_train.json
      md5: d82394295b6ce887e8934cd194dcc43c
      size: 247
    - path: metrics/keypoint/coco_val.json
      md5: a84d911708ca1ded41eb63f57f50ec7e
      size: 229
  train-segmentation:
    cmd: python watch_recognition/watch_recognition/train/segmentation_task.py --epochs
      60 --batch-size 32 --confidence-threshold 0.5 --seed 42
    deps:
    - path: checkpoints/segmentation/
      md5: 356fef3e785c6f0a9ad25ec881438cec.dir
      size: 84321131
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: c517cd143a36c8444e7e19718ab7153c.dir
      size: 94131818
      nfiles: 218
    - path: datasets/val
      md5: 076600f43bf920a12327e4f2a2d54754.dir
      size: 17704892
      nfiles: 37
    - path: datasets/watch-faces-local.json
      md5: c900823f5b63cc402ad8b7aa3aad8707
      size: 1028857
    - path: watch_recognition/watch_recognition/train/segmentation_task.py
      md5: 31611ed07c4dec05d217e9b9c4e2084a
      size: 7436
    params:
      params.yaml:
        seed: 42
        segmentation:
          epochs: 60
          batch-size: 32
          confidence-threshold: 0.5
    outs:
    - path: example_predictions/segmentation/test-image-2.jpg
      md5: ba595a7ae55c273114f220eb6a87d947
      size: 58883
    - path: metrics/segmentation.json
      md5: 5b71b33b1e1c79511e89e5fc4bd720fa
      size: 214
    - path: metrics/segmentation/scalars/
      md5: 306f94c3ef2be96ee6bab9d501da534a.dir
      size: 9017
      nfiles: 4
    - path: models/segmentation/
      md5: 7964f5d267cb6f2e7a5dcbd9a02e38f1.dir
      size: 36527221
      nfiles: 5
  eval-end-2-end:
    cmd: python watch_recognition/watch_recognition/eval/end-to-end-eval.py --concurrent
    deps:
    - path: datasets/watch-faces-local.json
      md5: 7bf58251585ed74a9dfbd79c2c97b908
      size: 1031086
    - path: models/detector
      md5: c8ee744e619baf859a79d31740caddad.dir
      size: 155280910
      nfiles: 6
    - path: models/keypoint
      md5: 3d14403bb1c0811c028e3ba8da69b497.dir
      size: 36542592
      nfiles: 6
    - path: models/segmentation
      md5: 3c12c44389ed179e56428f1ef23564cc.dir
      size: 36518038
      nfiles: 5
    outs:
    - path: metrics/end_2_end_eval.csv
      md5: f521a679167cdc0eadd0c28342370aab
      size: 14982
    - path: metrics/end_2_end_summary.json
      md5: 710a0a62121610d0eabb28bd982eb7ef
      size: 298
  eval-segmentation:
    cmd: python watch_recognition/watch_recognition/eval/segmentation_eval.py --confidence-threshold
      0.5
    deps:
    - path: models/detector/
      md5: cfb3ce9f1a3cb628e3ae52f24bda6ee0.dir
      size: 432222822
      nfiles: 6
    - path: models/segmentation/
      md5: 7964f5d267cb6f2e7a5dcbd9a02e38f1.dir
      size: 36527221
      nfiles: 5
    - path: watch_recognition/watch_recognition/eval/segmentation_eval.py
      md5: e0967190a45d3e7e9902786aff6caf4e
      size: 4105
    outs:
    - path: example_predictions/segmentation/train_0.jpg
      md5: 9ccd9d6d5feaf64e24b91b096f900def
      size: 42252
    - path: example_predictions/segmentation/train_1.jpg
      md5: 7bd487c620c2288c12d95c308fff6d7f
      size: 43138
    - path: example_predictions/segmentation/train_2.jpg
      md5: 42b02d8dc16016607b5ffdb7815ddece
      size: 42899
    - path: example_predictions/segmentation/train_3.jpg
      md5: 0b8da3d70568524bf018c4be15f55109
      size: 52590
    - path: example_predictions/segmentation/train_4.jpg
      md5: 655c36ca85fccbd9e86361a32eedb59f
      size: 46817
    - path: example_predictions/segmentation/val_0.jpg
      md5: b96110c3651c679f3572c2715f3cacc0
      size: 42996
    - path: example_predictions/segmentation/val_1.jpg
      md5: 1262c6f98600ce6d96d0f2fddfa4a3a4
      size: 43904
    - path: example_predictions/segmentation/val_2.jpg
      md5: 5c27d9e6e976ff2d90e2f0729adfc65c
      size: 43821
    - path: example_predictions/segmentation/val_3.jpg
      md5: 5a0bf82256373c90ed3e9346f9dd7299
      size: 51770
    - path: example_predictions/segmentation/val_4.jpg
      md5: 6999eb6194c4309c53e320baee55cc2a
      size: 46149
