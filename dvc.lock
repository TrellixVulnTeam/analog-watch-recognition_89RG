schema: '2.0'
stages:
  download-images:
    cmd: python scripts/download-images.py datasets/watch-faces.json
    deps:
    - path: datasets/watch-faces.json
      md5: f93609c3effe2e760da35f25c0ff9c4c
      size: 269170
    - path: scripts/download-images.py
      md5: 163a2ddbebf57d03fc4ac6640fff005b
      size: 1804
    outs:
    - path: datasets/test
      md5: 7984dcd13dac63d8243a11a0a1ba855b.dir
      size: 7801342
      nfiles: 3
    - path: datasets/train
      md5: 614dd9e449e47c6fc4090276a7626ce2.dir
      size: 62082243
      nfiles: 60
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: 6e1189368fbea652d848900678674c91
      size: 267583
  train-detector:
    cmd: python watch_recognition/watch_recognition/train/object_detection_task.py  --epochs
      10  --batch-size 4  --confidence-threshold 0.5  --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/detector/
      md5: 4f0ef251a21db42f82d745ffc44d4b34.dir
      size: 436687933
      nfiles: 3
    - path: datasets/test
      md5: 7984dcd13dac63d8243a11a0a1ba855b.dir
      size: 7801342
      nfiles: 3
    - path: datasets/train
      md5: 614dd9e449e47c6fc4090276a7626ce2.dir
      size: 62082243
      nfiles: 60
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: 6e1189368fbea652d848900678674c91
      size: 267583
    - path: watch_recognition/watch_recognition/train/object_detection_task.py
      md5: 086744635ca0d700fb3637163ae274b4
      size: 33179
    params:
      params.yaml:
        detector.batch-size: 4
        detector.epochs: 10
        seed: 42
    outs:
    - path: example_predictions/detector/test-image.jpg
      md5: ec3a989348c81979605762f7ec27dcc4
      size: 128356
    - path: metrics/detector.json
      md5: 82b9f8739f73e69fe4ca8ee7e47e24a1
      size: 131
    - path: metrics/detector/scalars
      md5: af63ee0efbdb2e90230e8a121ebc2122.dir
      size: 782
      nfiles: 2
    - path: models/detector/
      md5: 3457c7fe41ca133b5c6b00fe35f89865.dir
      size: 153534387
      nfiles: 5
  eval-detector:
    cmd: python watch_recognition/watch_recognition/eval/object_detection_eval.py
    deps:
    - path: models/detector/
      md5: 3457c7fe41ca133b5c6b00fe35f89865.dir
      size: 153534387
      nfiles: 5
    - path: watch_recognition/watch_recognition/eval/object_detection_eval.py
      md5: 080fe3096a2ec1867cd3f79e1e2fa8ee
      size: 5723
    outs:
    - path: example_predictions/detector/train_0.jpg
      md5: e3449cd52f2223869ba85aee35f6290c
      size: 99549
    - path: example_predictions/detector/train_1.jpg
      md5: 8e88f4c1b6adcef0f7c6af45e0fab7bd
      size: 86659
    - path: example_predictions/detector/train_2.jpg
      md5: e6dc47086ab70cdf854ef5a04d34c7fe
      size: 77285
    - path: example_predictions/detector/train_3.jpg
      md5: 555fe126c3e5064a3f303391d8c5cf02
      size: 58104
    - path: example_predictions/detector/train_4.jpg
      md5: a8a9fc1b22a766a11a26afff10f311df
      size: 96147
    - path: example_predictions/detector/val_0.jpg
      md5: ef10bb0a49b0d7ca1c345904fcf32f7c
      size: 83502
    - path: example_predictions/detector/val_1.jpg
      md5: 413a40008068ba21b86d5f5338516f66
      size: 133179
    - path: example_predictions/detector/val_2.jpg
      md5: a4d615915e87cbb4296084dda6b61d19
      size: 215464
    - path: example_predictions/detector/val_3.jpg
      md5: 83c511be541425a472fe77c048b464d6
      size: 112194
    - path: metrics/detector/PR-IoU@0.50_train.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.50_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.75_train.tsv
      md5: 221538d61bdd9eca544de90f41eef7d5
      size: 1512
    - path: metrics/detector/PR-IoU@0.75_val.tsv
      md5: 8a736d531c589c40648e33d01a87fd0a
      size: 1059
    - path: metrics/detector/PR-IoU@0.95_train.tsv
      md5: 2cb7b30073c0621d50a4b830fcbbf33a
      size: 1155
    - path: metrics/detector/PR-IoU@0.95_val.tsv
      md5: eb9c22f401e52e662cc9020d738478e0
      size: 1059
    - path: metrics/detector/coco_train.json
      md5: f55b8f7107d9b171a0d0a700ada73ee7
      size: 270
    - path: metrics/detector/coco_val.json
      md5: 73c7d31c040f2d2538b74e7cc79a309e
      size: 268
  update-metrics:
    cmd: python scripts/update-metrics-table-and-graph.py
    deps:
    - path: metrics
      md5: 9d74699e0d3d9121847bc3d06e8b6de5.dir
      size: 45158
      nfiles: 20
  train-keypoint:
    cmd: python watch_recognition/watch_recognition/train/heatmap_regression_task.py
      --epochs 10 --batch-size 8 --confidence-threshold 0.5 --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/keypoint/
      md5: 93aaf13ff65a6ac56d4a9b0562091545.dir
      size: 84348803
      nfiles: 3
    - path: datasets/test
      md5: 7984dcd13dac63d8243a11a0a1ba855b.dir
      size: 7801342
      nfiles: 3
    - path: datasets/train
      md5: 614dd9e449e47c6fc4090276a7626ce2.dir
      size: 62082243
      nfiles: 60
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: 6e1189368fbea652d848900678674c91
      size: 267583
    - path: watch_recognition/watch_recognition/train/heatmap_regression_task.py
      md5: cc09943d8f9abf641c2dfc7cbc0002af
      size: 6295
    params:
      params.yaml:
        keypoint:
          epochs: 10
          batch-size: 8
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/keypoint/test-image-2.jpg
      md5: 1be5a07678c7a3f603aed5560cefe0a8
      size: 53817
    - path: metrics/keypoint.json
      md5: be3636e73f34b9ab8f7aa9de7f2abc50
      size: 213
    - path: metrics/keypoint/scalars/
      md5: 77a37ccccdf277992ce99f0d1e4b5536.dir
      size: 1564
      nfiles: 4
    - path: models/keypoint/
      md5: 690436e5e98794d3f343fd2dc3c91614.dir
      size: 35771134
      nfiles: 5
  eval-keypoint:
    cmd: python watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      --kp-confidence-threshold 0.5
    deps:
    - path: models/detector/
      md5: 3457c7fe41ca133b5c6b00fe35f89865.dir
      size: 153534387
      nfiles: 5
    - path: models/keypoint/
      md5: 690436e5e98794d3f343fd2dc3c91614.dir
      size: 35771134
      nfiles: 5
    - path: watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      md5: 4dc66d28383582f2f6b017be820b05ec
      size: 6093
    outs:
    - path: example_predictions/keypoint/train_0.jpg
      md5: 5e99dcb852843fbb79cb158cf67b2c83
      size: 31352
    - path: example_predictions/keypoint/train_1.jpg
      md5: 6d2832973816d50c88a6216a203c4698
      size: 36766
    - path: example_predictions/keypoint/train_2.jpg
      md5: b870e8b59576c51ac933334c5227137c
      size: 39261
    - path: example_predictions/keypoint/train_3.jpg
      md5: 9a2a7acf14f1059580929577a6e50315
      size: 35320
    - path: example_predictions/keypoint/train_4.jpg
      md5: 4d548d85160e32d57df90478041d9d17
      size: 37751
    - path: example_predictions/keypoint/val_0.jpg
      md5: 8a552f3b919fede8a39b13d93a4075b2
      size: 47223
    - path: example_predictions/keypoint/val_1.jpg
      md5: 0a9286b4f27266bd822a380be2ae4bbf
      size: 50799
    - path: example_predictions/keypoint/val_2.jpg
      md5: 4b6a2f2283b52e515ffce7b93b51e30d
      size: 57478
    - path: example_predictions/keypoint/val_3.jpg
      md5: 7898a0e7b4ee0045753aadd0a250e5e6
      size: 48178
    - path: example_predictions/keypoint/val_4.jpg
      md5: b1de7978c0ef2f9b2208289963bf84d1
      size: 60560
    - path: metrics/keypoint/coco_train.json
      md5: b1d1692d48c5dbb2326fc367c0361935
      size: 261
    - path: metrics/keypoint/coco_val.json
      md5: 1e4bad55b0d453ebf8da5f7586e18e36
      size: 229
