schema: '2.0'
stages:
  download-images:
    cmd: python scripts/download-images.py datasets/watch-faces.json --concurrent
    deps:
    - path: datasets/watch-faces.json
      md5: 1363ea589ba9eebe3b05bef29020052c
      size: 859008
    - path: scripts/download-images.py
      md5: a037cfab1a482a356f1d7d62804041d3
      size: 3961
    outs:
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 9a3f5b148227c37600c3af6a9b0b0161.dir
      size: 82169507
      nfiles: 154
    - path: datasets/val
      md5: 8ac3dabbeb73f54d330cb1c0f26e8d62.dir
      size: 17982237
      nfiles: 36
    - path: datasets/watch-faces-local.json
      md5: 1b5e44191a0eadb1ef5c22deaec1f88f
      size: 853580
  train-detector:
    cmd: python watch_recognition/watch_recognition/train/object_detection_task.py  --epochs
      60  --batch-size 16  --confidence-threshold 0.5  --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/detector/
      md5: 4f0ef251a21db42f82d745ffc44d4b34.dir
      size: 436687933
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 17f79e1cbb37ff869a2b6109fd5ecff8.dir
      size: 79597491
      nfiles: 141
    - path: datasets/val
      md5: 36595d9dbbeadbc1801e2f9062eeac99.dir
      size: 8720873
      nfiles: 15
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/object_detection_task.py
      md5: 4f2a8f7f6133997316921fba3ea47740
      size: 32743
    params:
      params.yaml:
        detector:
          epochs: 60
          batch-size: 16
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/detector/test-image.jpg
      md5: fe24ea9d1a0e244575f238ed152a0bf5
      size: 128279
    - path: metrics/detector.json
      md5: ea705379b86dbc5104e5440fcfc972da
      size: 132
    - path: metrics/detector/scalars
      md5: 03f245dc5c6cb3611c23a0bdc604aa2d.dir
      size: 4592
      nfiles: 2
    - path: models/detector/
      md5: c1dd211879603999049fca62c1868afe.dir
      size: 155270393
      nfiles: 6
  eval-detector:
    cmd: python watch_recognition/watch_recognition/eval/object_detection_eval.py
    deps:
    - path: models/detector/
      md5: c1dd211879603999049fca62c1868afe.dir
      size: 155270393
      nfiles: 6
    - path: watch_recognition/watch_recognition/eval/object_detection_eval.py
      md5: 207dcb18332eb320dfd9caded5fa665f
      size: 5874
    outs:
    - path: example_predictions/detector/train_0.jpg
      md5: 5eb8a5e14159f6e8a3823365c63321a8
      size: 205096
    - path: example_predictions/detector/train_1.jpg
      md5: b689cc55f3f27fc22081ac60378cfca2
      size: 112176
    - path: example_predictions/detector/train_2.jpg
      md5: d2925189b0d77d9de9e8ad5a4ae32f07
      size: 89073
    - path: example_predictions/detector/train_3.jpg
      md5: 5789747df4e99c8ef118dc8d05e4fc83
      size: 136419
    - path: example_predictions/detector/train_4.jpg
      md5: 617734f6ac35bc8a86d1362256918a92
      size: 84607
    - path: example_predictions/detector/val_0.jpg
      md5: 6fff327932a1dbf7c85da45fb7f555bb
      size: 83888
    - path: example_predictions/detector/val_1.jpg
      md5: ff1371af3ee68af4b4efb17817cc3766
      size: 133263
    - path: example_predictions/detector/val_2.jpg
      md5: 3f103667819a7d36b9c9775f83d4cedc
      size: 203761
    - path: example_predictions/detector/val_3.jpg
      md5: 3623c9267d2ec973edba96a7acc4826a
      size: 112196
    - path: metrics/detector/PR-IoU@0.50_train.tsv
      md5: 544f7132cc2a628af9db9be8ee11a578
      size: 1842
    - path: metrics/detector/PR-IoU@0.50_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.75_train.tsv
      md5: c1342bd7da3f8e479d43a9a31dc1f163
      size: 1750
    - path: metrics/detector/PR-IoU@0.75_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.95_train.tsv
      md5: 68641d915241211ffe5a24429e43d978
      size: 1140
    - path: metrics/detector/PR-IoU@0.95_val.tsv
      md5: eb9c22f401e52e662cc9020d738478e0
      size: 1059
    - path: metrics/detector/coco_train.json
      md5: d9f38f574f3603ceccdf751ee1c3e54f
      size: 289
    - path: metrics/detector/coco_val.json
      md5: 23bba99a6c9b2700a811c39fd9d312f8
      size: 254
  update-metrics:
    cmd: python scripts/update-metrics-table-and-graph.py
    deps:
    - path: metrics
      md5: 952dbeb6b0e39b198ac2b59249545ba8.dir
      size: 230745
      nfiles: 36
  train-keypoint:
    cmd: python watch_recognition/watch_recognition/train/heatmap_regression_task.py
      --epochs 60 --batch-size 16 --confidence-threshold 0.5 --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/keypoint/
      md5: 93aaf13ff65a6ac56d4a9b0562091545.dir
      size: 84348803
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 17f79e1cbb37ff869a2b6109fd5ecff8.dir
      size: 79597491
      nfiles: 141
    - path: datasets/val
      md5: 36595d9dbbeadbc1801e2f9062eeac99.dir
      size: 8720873
      nfiles: 15
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/heatmap_regression_task.py
      md5: 16c5e2bb4360922c2ec1397ea8295d8b
      size: 7053
    params:
      params.yaml:
        keypoint:
          epochs: 60
          batch-size: 16
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/keypoint/test-image-2.jpg
      md5: c6c5c4ec8c4daa3844930257f72b7446
      size: 66283
    - path: metrics/keypoint.json
      md5: e4ff6bb5f0764939d095be33f0701d95
      size: 213
    - path: metrics/keypoint/scalars/
      md5: 563a688f02f3d6076a8653e219660449.dir
      size: 8995
      nfiles: 4
    - path: models/keypoint/
      md5: ce31f6725fa6a59dc2d385ef6a446ddf.dir
      size: 36529126
      nfiles: 6
  eval-keypoint:
    cmd: python watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      --kp-confidence-threshold 0.5
    deps:
    - path: models/detector/
      md5: c1dd211879603999049fca62c1868afe.dir
      size: 155270393
      nfiles: 6
    - path: models/keypoint/
      md5: ce31f6725fa6a59dc2d385ef6a446ddf.dir
      size: 36529126
      nfiles: 6
    - path: watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      md5: 1489e93239ed225a7b1ba65075ef48a2
      size: 6107
    outs:
    - path: example_predictions/keypoint/train_0.jpg
      md5: e562b729137fd4c9f3d6794fae454ad7
      size: 73575
    - path: example_predictions/keypoint/train_1.jpg
      md5: 14ca1d24b41933fca528abe8556fb117
      size: 51105
    - path: example_predictions/keypoint/train_2.jpg
      md5: 80ce0e75fe204693e32a155278651020
      size: 59948
    - path: example_predictions/keypoint/train_3.jpg
      md5: df6ccb4cc4389490f0479aaa891c5d78
      size: 27421
    - path: example_predictions/keypoint/train_4.jpg
      md5: 4668f8e4c9a5a9cf376d370712698de7
      size: 38932
    - path: example_predictions/keypoint/val_0.jpg
      md5: 24701c0fb409dbce1ab334170729e5e1
      size: 57170
    - path: example_predictions/keypoint/val_1.jpg
      md5: 2c01c475cfbd8f7e91080ca3270bae26
      size: 61443
    - path: example_predictions/keypoint/val_2.jpg
      md5: edc64698fc64fa022501e3919acaf52e
      size: 70448
    - path: example_predictions/keypoint/val_3.jpg
      md5: 41c497fbd026f428171b2b07b2b674e0
      size: 58993
    - path: example_predictions/keypoint/val_4.jpg
      md5: 917efcceca9f76333929e3a99df7698b
      size: 73887
    - path: metrics/keypoint/coco_train.json
      md5: cc7058522079a808238675b06cf550a7
      size: 235
    - path: metrics/keypoint/coco_val.json
      md5: 72ed9ab0bac7edc64c56fd0a96af6d94
      size: 229
  train-segmentation:
    cmd: python watch_recognition/watch_recognition/train/segmentation_task.py --epochs
      60 --batch-size 16 --confidence-threshold 0.5 --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/segmentation/
      md5: f69ac8b89feb20dbd86a7e770e9fe38e.dir
      size: 84321131
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 17f79e1cbb37ff869a2b6109fd5ecff8.dir
      size: 79597491
      nfiles: 141
    - path: datasets/val
      md5: 36595d9dbbeadbc1801e2f9062eeac99.dir
      size: 8720873
      nfiles: 15
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/segmentation_task.py
      md5: 31611ed07c4dec05d217e9b9c4e2084a
      size: 7436
    params:
      params.yaml:
        seed: 42
        segmentation:
          epochs: 60
          batch-size: 16
          confidence-threshold: 0.5
    outs:
    - path: example_predictions/segmentation/test-image-2.jpg
      md5: 85fc74b91e8da81c43387df4f726a191
      size: 58745
    - path: metrics/segmentation.json
      md5: 27aa3ecb086f3808594d34b23f6157fe
      size: 215
    - path: metrics/segmentation/scalars/
      md5: d9a2806a50f4ba40d78df73a2eac5204.dir
      size: 9054
      nfiles: 4
    - path: models/segmentation/
      md5: 6a57691da9cd754d52be71af438f297f.dir
      size: 36513754
      nfiles: 5
