schema: '2.0'
stages:
  download-images:
    cmd: python scripts/download-images.py datasets/watch-faces.json
    deps:
    - path: datasets/watch-faces.json
      md5: f93609c3effe2e760da35f25c0ff9c4c
      size: 269170
    - path: scripts/download-images.py
      md5: 163a2ddbebf57d03fc4ac6640fff005b
      size: 1804
    outs:
    - path: datasets/test
      md5: 7984dcd13dac63d8243a11a0a1ba855b.dir
      size: 7801342
      nfiles: 3
    - path: datasets/train
      md5: 614dd9e449e47c6fc4090276a7626ce2.dir
      size: 62082243
      nfiles: 60
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: 6e1189368fbea652d848900678674c91
      size: 267583
  train-detector:
    cmd: python watch_recognition/watch_recognition/train/object_detection_task.py  --epochs
      50  --batch-size 4  --confidence-threshold 0.5  --seed 42
    deps:
    - path: datasets/test
      md5: 7984dcd13dac63d8243a11a0a1ba855b.dir
      size: 7801342
      nfiles: 3
    - path: datasets/train
      md5: 614dd9e449e47c6fc4090276a7626ce2.dir
      size: 62082243
      nfiles: 60
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: 6e1189368fbea652d848900678674c91
      size: 267583
    - path: watch_recognition/watch_recognition/train/object_detection_task.py
      md5: c1abde53cbba80b698b7cf8ea4b356b4
      size: 32415
    params:
      params.yaml:
        detector.batch-size: 4
        detector.epochs: 50
        seed: 42
    outs:
    - path: example_predictions/detector/test-image.jpg
      md5: 0eccb3ca1b22a25c4997d1f83530793e
      size: 128346
    - path: metrics/detector.json
      md5: c71fb1b9fb30fbb6b376a1a01a6c287e
      size: 132
    - path: metrics/detector/scalars
      md5: 1fac2b1ae2dd2b37ab3bddc013c04b89.dir
      size: 3760
      nfiles: 2
    - path: models/detector/
      md5: bec7cd37960c828316c09a75394a824f.dir
      size: 153528239
      nfiles: 4
  eval-detector:
    cmd: python watch_recognition/watch_recognition/eval/object_detection_eval.py
    deps:
    - path: models/detector/
      md5: bec7cd37960c828316c09a75394a824f.dir
      size: 153528239
      nfiles: 4
    - path: watch_recognition/watch_recognition/eval/object_detection_eval.py
      md5: 080fe3096a2ec1867cd3f79e1e2fa8ee
      size: 5723
    outs:
    - path: example_predictions/detector/train_0.jpg
      md5: cabc2c69aa796588a6c059f96da260d5
      size: 103454
    - path: example_predictions/detector/train_1.jpg
      md5: e0ea1f8c4a7a84f70d05c9dcecbf6a8b
      size: 86988
    - path: example_predictions/detector/train_2.jpg
      md5: c1b5b7acbec60a859fcace2463cbd734
      size: 77569
    - path: example_predictions/detector/train_3.jpg
      md5: 0588b32df01743ce532fefaa5fa4c28d
      size: 58120
    - path: example_predictions/detector/train_4.jpg
      md5: 0c7d432a7c6fab9536ade2dc2a0804b8
      size: 96805
    - path: example_predictions/detector/val_0.jpg
      md5: 7eb8d7bd8341976325f7b7a1552d34c4
      size: 84150
    - path: example_predictions/detector/val_1.jpg
      md5: 1742607edf341cf8df4030eaeeb4df0e
      size: 132956
    - path: example_predictions/detector/val_2.jpg
      md5: 8a1af332da1feba18ea18ecc96c1c19f
      size: 211136
    - path: example_predictions/detector/val_3.jpg
      md5: 77cadee304762a788ec10c5545afda91
      size: 113012
    - path: metrics/detector/PR-IoU@0.50_train.tsv
      md5: 5af25cedd396448dc6e987e665c11209
      size: 1104
    - path: metrics/detector/PR-IoU@0.50_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.75_train.tsv
      md5: 3baf3532c32ebbdf1cd368a3dfbda815
      size: 1899
    - path: metrics/detector/PR-IoU@0.75_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.95_train.tsv
      md5: 291a0bc02857c668e83eb61f881e442e
      size: 1093
    - path: metrics/detector/PR-IoU@0.95_val.tsv
      md5: eb9c22f401e52e662cc9020d738478e0
      size: 1059
    - path: metrics/detector/coco_train.json
      md5: ddfc027145f224d94934d29048331968
      size: 285
    - path: metrics/detector/coco_val.json
      md5: a631e3ffbe322f4e575af87c7914ae7f
      size: 208
  update-metrics:
    cmd: python scripts/update-metrics-table-and-graph.py
    deps:
    - path: metrics
      md5: 6cb4e6707b4c9c5d92ed54958cf743b8.dir
      size: 89302
      nfiles: 20
  train-keypoint:
    cmd: python watch_recognition/watch_recognition/train/heatmap_regression_task.py
      --epochs 50 --batch-size 8 --confidence-threshold 0.5 --seed 42
    deps:
    - path: datasets/test
      md5: 7984dcd13dac63d8243a11a0a1ba855b.dir
      size: 7801342
      nfiles: 3
    - path: datasets/train
      md5: 614dd9e449e47c6fc4090276a7626ce2.dir
      size: 62082243
      nfiles: 60
    - path: datasets/val
      md5: e21bafb57ef37eafe2c29b95272491bb.dir
      size: 4076979
      nfiles: 6
    - path: datasets/watch-faces-local.json
      md5: 6e1189368fbea652d848900678674c91
      size: 267583
    - path: watch_recognition/watch_recognition/train/heatmap_regression_task.py
      md5: fc269ef0980037a20196b59f55d39fb0
      size: 5531
    params:
      params.yaml:
        keypoint:
          epochs: 50
          batch-size: 8
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/keypoint/test-image-2.jpg
      md5: 83b5cf9b6ecdec06a65ed298d0c551ac
      size: 54029
    - path: metrics/keypoint.json
      md5: 0ae9f6c69a73e4ee53c2b484317baa96
      size: 214
    - path: metrics/keypoint/scalars/
      md5: dc0bf923cee9afaa8e8cf7ee6234da53.dir
      size: 7522
      nfiles: 4
    - path: models/keypoint/
      md5: cb5debf945036c8c79411756ad340aaf.dir
      size: 164739511
      nfiles: 8
  eval-keypoint:
    cmd: python watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      --kp-confidence-threshold 0.5
    deps:
    - path: models/detector/
      md5: bec7cd37960c828316c09a75394a824f.dir
      size: 153528239
      nfiles: 4
    - path: models/keypoint/
      md5: cb5debf945036c8c79411756ad340aaf.dir
      size: 164739511
      nfiles: 8
    - path: watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      md5: 4dc66d28383582f2f6b017be820b05ec
      size: 6093
    outs:
    - path: example_predictions/keypoint/train_0.jpg
      md5: 5d24e0f13ab5bce3b9e6315bb3d840d2
      size: 31981
    - path: example_predictions/keypoint/train_1.jpg
      md5: 113e7bd7d5747a2eb178793bc0f34b36
      size: 36756
    - path: example_predictions/keypoint/train_2.jpg
      md5: 573181ac183972e08c5e58fda64f8fb0
      size: 39230
    - path: example_predictions/keypoint/train_3.jpg
      md5: c60d045eef270b8a6304c99f9fc42e6a
      size: 35337
    - path: example_predictions/keypoint/train_4.jpg
      md5: 78af07306ed1b95009c5e92239eb8832
      size: 37734
    - path: example_predictions/keypoint/val_0.jpg
      md5: 7f7a0d0f1a4393f399f5edc666065b83
      size: 47225
    - path: example_predictions/keypoint/val_1.jpg
      md5: 68d1f23e37097d74e78b3f7544427f80
      size: 50793
    - path: example_predictions/keypoint/val_2.jpg
      md5: 0c001f7327d2623071c2904d83239fd4
      size: 57371
    - path: example_predictions/keypoint/val_3.jpg
      md5: 4cd7b330cfb57dbefdeea1f586fca6ad
      size: 48183
    - path: example_predictions/keypoint/val_4.jpg
      md5: b1bf1bde50f01fd683767a98b3db12ac
      size: 60557
    - path: metrics/keypoint/coco_train.json
      md5: f87887788fa6949fd5b80b1d2c94a92a
      size: 260
    - path: metrics/keypoint/coco_val.json
      md5: 063fce329872e618e5353445ad22c57d
      size: 215
