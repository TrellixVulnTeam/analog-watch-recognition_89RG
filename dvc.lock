schema: '2.0'
stages:
  download-images:
    cmd: python scripts/download-images.py datasets/watch-faces.json --concurrent
    deps:
    - path: datasets/watch-faces.json
      md5: e00b9915f01e7e120532a6d54a61c252
      size: 585871
    - path: scripts/download-images.py
      md5: a037cfab1a482a356f1d7d62804041d3
      size: 3961
    outs:
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 9a3f5b148227c37600c3af6a9b0b0161.dir
      size: 82169507
      nfiles: 154
    - path: datasets/val
      md5: 8ac3dabbeb73f54d330cb1c0f26e8d62.dir
      size: 17982237
      nfiles: 36
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
  train-detector:
    cmd: python watch_recognition/watch_recognition/train/object_detection_task.py  --epochs
      60  --batch-size 16  --confidence-threshold 0.5  --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/detector/
      md5: 4f0ef251a21db42f82d745ffc44d4b34.dir
      size: 436687933
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 9a3f5b148227c37600c3af6a9b0b0161.dir
      size: 82169507
      nfiles: 154
    - path: datasets/val
      md5: 8ac3dabbeb73f54d330cb1c0f26e8d62.dir
      size: 17982237
      nfiles: 36
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/object_detection_task.py
      md5: 4f2a8f7f6133997316921fba3ea47740
      size: 32743
    params:
      params.yaml:
        detector:
          epochs: 60
          batch-size: 16
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/detector/test-image.jpg
      md5: 9db320fdf39208bae9338823b9e582c1
      size: 128409
    - path: metrics/detector.json
      md5: 59b9bae541c25d379c42725626a8e258
      size: 134
    - path: metrics/detector/scalars
      md5: acc35a5cf06beb10a979a4ce5cfd2cf9.dir
      size: 4577
      nfiles: 2
    - path: models/detector/
      md5: 42912b92d8e8dcd32be110e131ec3b0f.dir
      size: 155270393
      nfiles: 6
  eval-detector:
    cmd: python watch_recognition/watch_recognition/eval/object_detection_eval.py
    deps:
    - path: models/detector/
      md5: 42912b92d8e8dcd32be110e131ec3b0f.dir
      size: 155270393
      nfiles: 6
    - path: watch_recognition/watch_recognition/eval/object_detection_eval.py
      md5: 4158239597b8bb9d7d216728e0840605
      size: 6019
    outs:
    - path: example_predictions/detector/train_0.jpg
      md5: 556616f4d36571d64d4b0779630ad67b
      size: 205069
    - path: example_predictions/detector/train_1.jpg
      md5: 60bcded29355626d04c01ca89ead8bd6
      size: 112157
    - path: example_predictions/detector/train_2.jpg
      md5: 7e7ec1b270077a98146c22ee25a4266a
      size: 89335
    - path: example_predictions/detector/train_3.jpg
      md5: 080eb869b8fdf192cc30c44d107889f3
      size: 137087
    - path: example_predictions/detector/train_4.jpg
      md5: b278745f3b997e864449327268298274
      size: 84634
    - path: example_predictions/detector/val_0.jpg
      md5: 6fff327932a1dbf7c85da45fb7f555bb
      size: 83888
    - path: example_predictions/detector/val_1.jpg
      md5: 276deeaef314e36b42a92686486d251a
      size: 133258
    - path: example_predictions/detector/val_2.jpg
      md5: afa204e2c87292217f8d95df2b8dddcb
      size: 203542
    - path: example_predictions/detector/val_3.jpg
      md5: b550fed2de6bb460f23238263c7ca61b
      size: 112324
    - path: metrics/detector/PR-IoU@0.50_train.tsv
      md5: c0d69a86e5bde499ed60df9f6512f568
      size: 1780
    - path: metrics/detector/PR-IoU@0.50_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.75_train.tsv
      md5: 7fbd926972f3fd164cd544a5d1d25acd
      size: 1718
    - path: metrics/detector/PR-IoU@0.75_val.tsv
      md5: d3196f21e47a77724bec0b8293e1e81d
      size: 1059
    - path: metrics/detector/PR-IoU@0.95_train.tsv
      md5: 668fb109cb68affa6c345a25cab30378
      size: 1108
    - path: metrics/detector/PR-IoU@0.95_val.tsv
      md5: eb9c22f401e52e662cc9020d738478e0
      size: 1059
    - path: metrics/detector/coco_train.json
      md5: 3563ee319ec251b8ea7175bd84ff7c2a
      size: 261
    - path: metrics/detector/coco_val.json
      md5: 282bbd3a4cd87a44dbc66863456f5ce5
      size: 212
  update-metrics:
    cmd: python scripts/update-metrics-table-and-graph.py
    deps:
    - path: metrics
      md5: 451573672fc11da63fe63b1b33d1fa74.dir
      size: 230559
      nfiles: 36
  train-keypoint:
    cmd: python watch_recognition/watch_recognition/train/heatmap_regression_task.py
      --epochs 60 --batch-size 16 --confidence-threshold 0.5 --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/keypoint/
      md5: 93aaf13ff65a6ac56d4a9b0562091545.dir
      size: 84348803
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 9a3f5b148227c37600c3af6a9b0b0161.dir
      size: 82169507
      nfiles: 154
    - path: datasets/val
      md5: 8ac3dabbeb73f54d330cb1c0f26e8d62.dir
      size: 17982237
      nfiles: 36
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/heatmap_regression_task.py
      md5: 16c5e2bb4360922c2ec1397ea8295d8b
      size: 7053
    params:
      params.yaml:
        keypoint:
          epochs: 60
          batch-size: 16
          confidence-threshold: 0.5
        seed: 42
    outs:
    - path: example_predictions/keypoint/test-image-2.jpg
      md5: 880aa5e56dd1cf04ee0915927b488b71
      size: 66340
    - path: metrics/keypoint.json
      md5: 19c806940dd1d206c5816bfa32475ddd
      size: 214
    - path: metrics/keypoint/scalars/
      md5: d0a51cb71034cbcf222b38852562271b.dir
      size: 9004
      nfiles: 4
    - path: models/keypoint/
      md5: 731d4d166924ea9fb9354d7977a147ed.dir
      size: 36529126
      nfiles: 6
  eval-keypoint:
    cmd: python watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      --kp-confidence-threshold 0.5
    deps:
    - path: models/detector/
      md5: 42912b92d8e8dcd32be110e131ec3b0f.dir
      size: 155270393
      nfiles: 6
    - path: models/keypoint/
      md5: 731d4d166924ea9fb9354d7977a147ed.dir
      size: 36529126
      nfiles: 6
    - path: watch_recognition/watch_recognition/eval/keypoint_detection_eval.py
      md5: 3b25b23a8c308884c58b6d5ac4261f0d
      size: 6263
    outs:
    - path: example_predictions/keypoint/train_0.jpg
      md5: 1ed1a379ef635dd3ded4767d62a5e9b4
      size: 73578
    - path: example_predictions/keypoint/train_1.jpg
      md5: 14ca1d24b41933fca528abe8556fb117
      size: 51105
    - path: example_predictions/keypoint/train_2.jpg
      md5: 80ce0e75fe204693e32a155278651020
      size: 59948
    - path: example_predictions/keypoint/train_3.jpg
      md5: df6ccb4cc4389490f0479aaa891c5d78
      size: 27421
    - path: example_predictions/keypoint/train_4.jpg
      md5: 4668f8e4c9a5a9cf376d370712698de7
      size: 38932
    - path: example_predictions/keypoint/val_0.jpg
      md5: c961d1605cc10d8c37264717eac1475c
      size: 57199
    - path: example_predictions/keypoint/val_1.jpg
      md5: 33c30e8749a8e3384438ce6a83b8ed42
      size: 61429
    - path: example_predictions/keypoint/val_2.jpg
      md5: 1467fece4bfe28568b0bb0878aa2b27d
      size: 69993
    - path: example_predictions/keypoint/val_3.jpg
      md5: 9c633a2fe76742979b67a6953f95d8bf
      size: 58988
    - path: example_predictions/keypoint/val_4.jpg
      md5: e0cb1a5f356e82f2a7d79ed7b6340a4a
      size: 73856
    - path: metrics/keypoint/coco_train.json
      md5: e27e89f610ace7a5ee7068b816e9a527
      size: 250
    - path: metrics/keypoint/coco_val.json
      md5: 96b7a0e454b264bc307a6559d509c399
      size: 244
  train-segmentation:
    cmd: python watch_recognition/watch_recognition/train/segmentation_task.py --epochs
      60 --batch-size 16 --confidence-threshold 0.5 --seed 42 --fine-tune-from-checkpoint
    deps:
    - path: checkpoints/segmentation/
      md5: f69ac8b89feb20dbd86a7e770e9fe38e.dir
      size: 84321131
      nfiles: 3
    - path: datasets/test
      md5: 6904a01888485f56672750554a7bb1e0.dir
      size: 16911707
      nfiles: 46
    - path: datasets/train
      md5: 9a3f5b148227c37600c3af6a9b0b0161.dir
      size: 82169507
      nfiles: 154
    - path: datasets/val
      md5: 8ac3dabbeb73f54d330cb1c0f26e8d62.dir
      size: 17982237
      nfiles: 36
    - path: datasets/watch-faces-local.json
      md5: db7c3dda8302f2f04fc4d627941d0551
      size: 581754
    - path: watch_recognition/watch_recognition/train/segmentation_task.py
      md5: 31611ed07c4dec05d217e9b9c4e2084a
      size: 7436
    params:
      params.yaml:
        seed: 42
        segmentation:
          epochs: 60
          batch-size: 16
          confidence-threshold: 0.5
    outs:
    - path: example_predictions/segmentation/test-image-2.jpg
      md5: 7284dd3a80530da8930572f4113e0031
      size: 58677
    - path: metrics/segmentation.json
      md5: 4e1a531530f9bb061f17e7fd1f9f9edd
      size: 214
    - path: metrics/segmentation/scalars/
      md5: 30c4597f228e107621795628b0a9cce0.dir
      size: 9047
      nfiles: 4
    - path: models/segmentation/
      md5: 5cfbebee61922d3417a391fffafc8cf2.dir
      size: 36513754
      nfiles: 5
